{"version":3,"file":"exts_parser.js","sourceRoot":"","sources":["exts_parser.ts"],"names":[],"mappings":"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","sourcesContent":["const TOKEN = /([!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z]+)/;\nconst NOTOKEN = /([^!#\\$%&'\\*\\+\\-\\.\\^_`\\|~0-9a-z])/g;\nconst QUOTED = /\"((?:\\\\[\\x00-\\x7f]|[^\\x00-\\x08\\x0a-\\x1f\\x7f\"])*)\"/;\nconst PARAM = new RegExp(TOKEN.source + '(?:=(?:' + TOKEN.source + '|' + QUOTED.source + '))?');\nconst EXT = new RegExp(TOKEN.source + '(?: *; *' + PARAM.source + ')*', 'g');\nconst EXT_LIST = new RegExp('^' + EXT.source + '(?: *, *' + EXT.source + ')*$');\nconst NUMBER = /^-?(0|[1-9][0-9]*)(\\.[0-9]+)?$/;\n\nexport class Offers {\n    private _byName;\n    private _inOrder;\n\n    public constructor() {\n        this._byName = {};\n        this._inOrder = [];\n    }\n\n    public push(name, params) {\n        this._byName[name] = this._byName[name] || [];\n        this._byName[name].push(params);\n        this._inOrder.push({name: name, params: params});\n    }\n\n    public eachOffer(callback, context) {\n        var list = this._inOrder;\n        for (var i = 0, n = list.length; i < n; i++)\n            callback.call(context, list[i].name, list[i].params);\n    }\n\n    public byName(name) {\n        return this._byName[name] || [];\n    }\n\n    public toArray() {\n        return this._inOrder.slice();\n    }\n}\nexport class Parser {\n    static parseHeader(header) {\n        var offers = new Offers();\n        if (header === '' || header === undefined) return offers;\n\n        if (!EXT_LIST.test(header))\n            throw new SyntaxError('Invalid Sec-WebSocket-Extensions header: ' + header);\n\n        var values = header.match(EXT);\n\n        values.forEach(function (value) {\n            var params = value.match(new RegExp(PARAM.source, 'g')),\n                name = params.shift(),\n                offer = {};\n\n            params.forEach(function (param) {\n                var args = param.match(PARAM), key = args[1], data;\n\n                if (args[2] !== undefined) {\n                    data = args[2];\n                } else if (args[3] !== undefined) {\n                    data = args[3].replace(/\\\\/g, '');\n                } else {\n                    data = true;\n                }\n                if (NUMBER.test(data)) data = parseFloat(data);\n\n                if (offer.hasOwnProperty(key)) {\n                    offer[key] = [].concat(offer[key]);\n                    offer[key].push(data);\n                } else {\n                    offer[key] = data;\n                }\n            }, this);\n            offers.push(name, offer);\n        }, this);\n\n        return offers;\n    }\n\n    static serializeParams(name, params) {\n        var values = [];\n        var print = function (key, value) {\n            if (Array.isArray(value)) {\n                value.forEach(function (v) {\n                    print(key, v)\n                });\n            } else if (value === true) {\n                values.push(key);\n            } else if (typeof value === 'number') {\n                values.push(key + '=' + value);\n            } else if (NOTOKEN.test(value)) {\n                values.push(key + '=\"' + value.replace(/\"/g, '\\\\\"') + '\"');\n            } else {\n                values.push(key + '=' + value);\n            }\n        };\n\n        for (var key in params){\n            print(key, params[key]);\n        }\n\n        return [name].concat(values).join('; ');\n    }\n}\n"]}