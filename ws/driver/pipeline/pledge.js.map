{"version":3,"file":"pledge.js","sourceRoot":"","sources":["pledge.ts"],"names":[],"mappings":";;IAEA;QAGS,UAAG,GAAV,UAAW,IAAI;YACb,IAAI,MAAM,GAAI,IAAI,MAAM,EAAE,EACtB,OAAO,GAAG,IAAI,CAAC,MAAM,EACrB,CAAC,GAAS,OAAO,CAAC;YAEtB,EAAE,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC;gBAAC,MAAM,CAAC,IAAI,EAAE,CAAC;YAEjC,OAAO,CAAC,EAAE;gBAAE,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;oBACvB,OAAO,IAAI,CAAC,CAAC;oBACb,EAAE,CAAC,CAAC,OAAO,KAAK,CAAC,CAAC;wBAAC,MAAM,CAAC,IAAI,EAAE,CAAC;gBACnC,CAAC,CAAC,CAAC;YACH,MAAM,CAAC,MAAM,CAAC;QAChB,CAAC;QAQM,qBAAI,GAAX,UAAY,QAAQ;YAClB,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC;gBAAC,QAAQ,EAAE,CAAC;YAC/B,IAAI;gBAAC,IAAI,CAAC,UAAU,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;QACtC,CAAC;QACM,qBAAI,GAAX;YACE,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;YACtB,IAAI,SAAS,GAAG,IAAI,CAAC,UAAU,EAAE,QAAQ,CAAC;YAC1C,OAAO,QAAQ,GAAG,SAAS,CAAC,KAAK,EAAE;gBAAE,QAAQ,EAAE,CAAC;QAClD,CAAC;;;YA7BM,iBAAU,GAAG,CAAC,CAAC;;QA8BxB,aAAC;QAbC;YACE,IAAI,CAAC,SAAS,GAAI,KAAK,CAAC;YACxB,IAAI,CAAC,UAAU,GAAG,IAAI,wBAAU,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC;QACtD,CAAC;IAUH,CAAC,AAhCD,IAgCC;;IAhCD,+BAgCC,CAAA;;;;;;;YAhCD,qBAAA,MAgCC","sourcesContent":["import {RingBuffer} from \"./ring_buffer\";\n\nexport class Pledge {\n\n  static QUEUE_SIZE = 4;\n  static all(list) {\n    var pledge  = new Pledge(),\n        pending = list.length,\n        n       = pending;\n\n    if (pending === 0) pledge.done();\n\n    while (n--) list[n].then(function() {\n      pending -= 1;\n      if (pending === 0) pledge.done();\n    });\n    return pledge;\n  }\n\n  protected _complete;\n  private _callbacks;\n  public constructor() {\n    this._complete  = false;\n    this._callbacks = new RingBuffer(Pledge.QUEUE_SIZE);\n  }\n  public then(callback) {\n    if (this._complete) callback();\n    else this._callbacks.push(callback);\n  }\n  public done() {\n    this._complete = true;\n    var callbacks = this._callbacks, callback;\n    while (callback = callbacks.shift()) callback();\n  }\n}\n\n"]}